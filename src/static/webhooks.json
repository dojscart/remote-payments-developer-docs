{
    "openapi": "3.1.0",
    "info": {
      "title": "Webhooks Configuration",
      "version": "1.0"
    },
    "servers": [
      {
        "url": "http://localhost:3000"
      }
    ],
    "paths": {
      "/api/webhook-definitions": {
        "post": {
          "summary": "Register Webhook Definition",
          "tags": [],
          "responses": {
            "200": {
              "description": "OK"
            },
            "201": {
              "description": "Created"
            },
            "400": {
              "description": "Bad Request"
            },
            "500": {
              "description": "Internal Server Error"
            }
          },
          "operationId": "post-api-webhookdefinitions",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebhookRegistrationRequest"
                },
                "examples": {
                  "example-1": {
                    "value": {
                      "name": "item1",
                      "sourceTopicName": "remotepayments_webhooks-test-topic1",
                      "sourceProjectId": "gcp-project-id",
                      "itemType": "item1",
                      "itemTypeVersion": {
                        "version": "2020-1-1",
                        "sourceItemTypeSchema": {
                          "Field1": "System.String",
                          "Field2": "System.Collections.Generic.List`1[[System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]]",
                          "Field3": {
                            "Field31": "System.DateTime",
                            "Field32": "System.Int32"
                          }
                        },
                        "targetItemTypeSchema": {
                          "Field1": "System.String",
                          "Field3": {
                            "Field31": "System.DateTime"
                          }
                        }
                      },
                      "allowedEventTypes": [
                        "item1.created",
                        "item1.deleted"
                      ]
                    }
                  }
                }
              }
            }
          },
          "parameters": [],
          "description": "Register a new webhook definition.",
          "x-internal": true
        },
        "parameters": [],
        "get": {
          "summary": "",
          "operationId": "get-api-webhook-definitions",
          "responses": {
            "200": {
              "description": "OK",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/WebhookDefinition"
                    }
                  }
                }
              }
            },
            "400": {
              "description": "Bad Request"
            },
            "404": {
              "description": "Not Found"
            },
            "500": {
              "description": "Internal Server Error"
            }
          },
          "parameters": [
            {
              "$ref": "#/components/parameters/since"
            }
          ],
          "description": "Retrieve all webhook definitions including versions that where updated/created since a specific date. ",
          "x-internal": true
        }
      },
      "/api/webhook-subscribtions": {
        "parameters": [],
        "post": {
          "summary": "",
          "operationId": "post-api-webhook-definitions-webhookId-subscribe",
          "responses": {
            "200": {
              "$ref": "#/components/responses/WebhookSubcriptionResponse"
            },
            "201": {
              "$ref": "#/components/responses/WebhookSubcriptionResponse"
            },
            "400": {
              "description": "Bad Request"
            },
            "404": {
              "description": "Not Found"
            },
            "500": {
              "description": "Internal Server Error"
            }
          },
          "parameters": [
            {
              "$ref": "#/components/parameters/Account-Id"
            },
            {
              "$ref": "#/components/parameters/Version"
            }
          ],
          "description": "Api to subscribe remote payments account holders to webhook events.",
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebhookSubcriptionRequests"
                }
              },
              "application/xml": {
                "schema": {
                  "type": "object",
                  "properties": {}
                }
              },
              "multipart/form-data": {
                "schema": {
                  "type": "object",
                  "properties": {}
                }
              }
            }
          }
        }
      },
      "/api/webhook-subscriptions/search": {
        "post": {
          "summary": "",
          "operationId": "post-api-webhook-definitions-search",
          "responses": {
            "200": {
              "description": "OK",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/WebhookSubscription"
                    }
                  }
                }
              }
            },
            "400": {
              "description": "Bad Request"
            },
            "404": {
              "description": "Not Found"
            },
            "500": {
              "description": "Internal Server Error"
            }
          },
          "description": "Search webhook subscriptions by subscriber, item type and version.",
          "x-internal": true,
          "parameters": [],
          "requestBody": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebhookSubscriptionsSearchRequest"
                },
                "examples": {
                  "example-1": {
                    "value": {
                      "subscriberId": "string",
                      "itemType": "string",
                      "version": "string"
                    }
                  }
                }
              }
            },
            "description": "Webhook subscriptions search request."
          },
          "tags": [
            "webhook-subscription"
          ]
        }
      }
    },
    "components": {
      "schemas": {
        "WebhookDefinition": {
          "title": "WebhookDefinition",
          "type": "object",
          "examples": [
            {
              "id": "string"
            }
          ],
          "properties": {
            "id": {
              "type": "string",
              "description": "Unique Database identifier, prefixed with \"wh_\"."
            },
            "name": {
              "type": "string",
              "description": "Webhook friendly name."
            },
            "sourceProjectId": {
              "type": "string",
              "description": "In this case, GCP project id, where source topic is hosted. Only if the topic is not in the same project with the webhook configurtion service."
            },
            "sourceTopicName": {
              "type": "string",
              "description": "The name of the topic the webhook handler will listen to in order to get internal events."
            },
            "itemType": {
              "type": "string",
              "description": "Name of the internal event item type to listen to."
            },
            "allowedEventTypes": {
              "type": "array",
              "description": "Events allowed to be streamed to the subscriber, if empty all be allowed.",
              "items": {
                "type": "string"
              }
            },
            "itemTypeVersions": {
              "type": "array",
              "description": "All item type version supported by the webhook.",
              "items": {
                "$ref": "#/components/schemas/ItemTypeVersion"
              }
            }
          }
        },
        "ItemTypeVersion": {
          "title": "ItemTypeVersion",
          "type": "object",
          "examples": [
            {
              "version": "string",
              "sourceItemTypeSchema": {
                "Field1": "System.String",
                "Field2": "System.Collections.Generic.List`1[[System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]]",
                "Field3": {
                  "Field31": "System.DateTime",
                  "Field32": "System.Int32"
                }
              },
              "targetItemTypeSchema": {
                "Field1": "System.String",
                "Field3": {
                  "Field31": "System.DateTime"
                }
              }
            }
          ],
          "properties": {
            "version": {
              "type": "string",
              "description": "API version of the incoming event Data item type."
            },
            "sourceItemTypeSchema": {
              "type": "object",
              "description": "Incoming event Data Item schema."
            },
            "targetItemTypeSchema": {
              "type": "object",
              "description": "Target schema of the Data item sent to the subscriber."
            }
          },
          "required": [
            "version",
            "sourceItemTypeSchema",
            "targetItemTypeSchema"
          ]
        },
        "WebhookSubscriber": {
          "title": "WebhookSubscriber",
          "type": "object",
          "description": "",
          "properties": {
            "id": {
              "type": "string",
              "description": "Unique database identifier, prefixed with \"whs_\"."
            },
            "subscriberId": {
              "type": "string",
              "description": "Unique identification for the subscriber, in remote payments it will be the Remote Payments Account Id."
            },
            "webhookSubscriptions": {
              "type": "array",
              "description": "References to all webhook definitions and Data item versions the current subscriber is subscribed to.",
              "items": {
                "$ref": "#/components/schemas/WebhookSubscription"
              }
            }
          }
        },
        "WebhookSubscription": {
          "title": "WebhookSubscription",
          "type": "object",
          "description": "",
          "properties": {
            "webhookDefinitionId": {
              "type": "string",
              "description": "Unique identifier for the webhook definition."
            },
            "itemTypeVersion": {
              "type": "string",
              "description": "The version of the item type the subsbscriber should receive."
            },
            "webhookUri": {
              "type": "string",
              "description": "The URL where the webhook message will be sent."
            },
            "secret": {
              "type": "string"
            }
          }
        },
        "WebhookRegistrationRequest": {
          "title": "WebhookRegistrationRequest",
          "type": "object",
          "examples": [
            {
              "name": "item1",
              "sourceTopicName": "remotepayments_webhooks-test-topic1",
              "itemType": "item1",
              "sourceProjectId": "gcp-project-id",
              "itemTypeVersion": {
                "version": "2020-1-1",
                "sourceItemTypeSchema": {
                  "Field1": "System.String",
                  "Field2": "System.Collections.Generic.List`1[[System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]]",
                  "Field3": {
                    "Field31": "System.DateTime",
                    "Field32": "System.Int32"
                  }
                },
                "targetItemTypeSchema": {
                  "Field1": "System.String",
                  "Field3": {
                    "Field31": "System.DateTime"
                  }
                }
              },
              "allowedEventTypes": [
                "item1.created",
                "item1.deleted"
              ]
            }
          ],
          "properties": {
            "webhookName": {
              "type": "string",
              "description": "Name of webhook, as it will be shown to subscribers.\n"
            },
            "sourceProjectId": {
              "type": "string",
              "description": "In this case, GCP project id, where source topic is hosted. Only if the topic is not in the same project with the webhook configurtion service."
            },
            "sourceTopicName": {
              "type": "string",
              "description": "The name of the topic the webhook handler will listen to in order to get internal events."
            },
            "itemType": {
              "type": "string",
              "description": "Name of the internal event item type to listen to."
            },
            "itemTypeVersion": {
              "$ref": "#/components/schemas/ItemTypeVersion"
            },
            "allowedEventTypes": {
              "type": "array",
              "description": "Events allowed to be streamed to the subscriber, if empty all be allowed.",
              "items": {
                "type": "string"
              }
            }
          },
          "required": [
            "webhookName",
            "sourceTopicName",
            "itemType",
            "itemTypeVersion"
          ]
        },
        "WebhookSubscriptionsSearchRequest": {
          "title": "WebhookSubscriptionsSearchRequest",
          "type": "object",
          "examples": [
            {
              "subscriberId": "string",
              "itemType": "string",
              "version": "string"
            }
          ],
          "properties": {
            "subscriberId": {
              "type": "string"
            },
            "webhookDefinitionId": {
              "type": "string"
            },
            "itemTypeVersion": {
              "type": "string"
            }
          },
          "required": [
            "subscriberId",
            "webhookDefinitionId",
            "itemTypeVersion"
          ]
        },
        "WebhookSubcriptionRequests": {
          "title": "WebhookSubcriptionRequests",
          "type": "object",
          "properties": {
            "webhookId ": {
              "type": "string",
              "description": "Id of the webhook definition."
            }
          },
          "required": [
            "webhookId "
          ]
        }
      },
      "parameters": {
        "since": {
          "name": "since",
          "in": "query",
          "required": true,
          "schema": {
            "type": "string"
          },
          "description": "Date from when to look-up created/updated webhook definitions and versions. If not specified, it will return nothing."
        },
        "webhookId": {
          "name": "webhookId",
          "in": "path",
          "required": true,
          "schema": {
            "type": "string"
          },
          "description": "Id of the webhook definition"
        },
        "Account-Id": {
          "name": "Account-Id",
          "in": "header",
          "required": true,
          "schema": {
            "type": "string"
          },
          "description": "Webhook subscriber Id, in remote payments it will be the Remote Payment Account Id"
        },
        "Version": {
          "name": "Version",
          "in": "header",
          "required": true,
          "schema": {
            "type": "string"
          },
          "description": "API version, Eg.: 2020-01-01 "
        }
      },
      "responses": {
        "WebhookDefinitionsSinceResponse": {
          "description": "Example response",
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/WebhookDefinition"
                }
              },
              "examples": {
                "example-1": {
                  "value": [
                    {
                      "id": "string"
                    }
                  ]
                }
              }
            }
          }
        },
        "WebhookSubcriptionResponse": {
          "description": "Example response",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "itemTypeVersion": {
                    "type": "string"
                  },
                  "secret": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    }
  }